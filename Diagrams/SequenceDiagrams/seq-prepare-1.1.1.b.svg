<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2275px" preserveAspectRatio="none" style="width:1930px;height:2275px;" version="1.1" viewBox="0 0 1930 2275" width="1930px" zoomAndPan="magnify"><defs><filter height="300%" id="f1uuq07un4ikqq" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="370" x="781" y="23.5352">1.1.1.b. Prepare Handler Consume (batch messages)</text><rect fill="#FFFFE0" height="2230.3359" style="stroke: #A80036; stroke-width: 1.0;" width="1847" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="892" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="102" y="171.9082"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="2063.0488" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="472" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="994" y="2137.3359"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1410.5" y="960.0508"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1410.5" y="1587.6406"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1527" y="427.082"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1527" y="693.5664"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1809" y="456.3926"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1809" y="722.877"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1809" y="989.3613"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1809" y="1616.9512"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="2049.0488" style="stroke: #000000; stroke-width: 2.0;" width="1906" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="821" x="388" y="216.9082"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="252.4844" style="stroke: #000000; stroke-width: 2.0;" width="1484" x="388" y="388.4609"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="252.4844" style="stroke: #000000; stroke-width: 2.0;" width="1484" x="388" y="654.9453"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1484" x="388" y="921.4297"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="1029.7324" style="stroke: #000000; stroke-width: 2.0;" width="1541" x="368" y="1145.6035"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="365.1055" style="stroke: #000000; stroke-width: 2.0;" width="631" x="378" y="1169.9141"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="610" x="388" y="1194.2246"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="611" x="388" y="1267.8457"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="554" x="388" y="1341.4668"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1511" x="388" y="1549.0195"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="107" x2="107" y1="116.2871" y2="2199.3359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="477" x2="477" y1="116.2871" y2="2199.3359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="999" x2="999" y1="116.2871" y2="2199.3359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1146" x2="1146" y1="116.2871" y2="2199.3359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1282" x2="1282" y1="116.2871" y2="2199.3359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1415" x2="1415" y1="116.2871" y2="2199.3359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1532" x2="1532" y1="116.2871" y2="2199.3359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1814" x2="1814" y1="116.2871" y2="2199.3359"/><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="27" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="23" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="30" y="101.334">Prepare-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="27" y="2198.3359"/><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="160" x="23" y="2202.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="30" y="2222.8711">Prepare-Topic-dfsp1</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="398" y="113.334">Prepare Event Handler</text><ellipse cx="477" cy="83.7988" fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="473,71.7988,479,66.7988,477,71.7988,479,76.7988,473,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="152" x="398" y="2211.8711">Prepare Event Handler</text><ellipse cx="477" cy="2230.8242" fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="473,2218.8242,479,2213.8242,477,2218.8242,479,2223.8242,473,2218.8242" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="918" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="914" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="921" y="101.334">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="918" y="2198.3359"/><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="914" y="2202.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="148" x="921" y="2222.8711">Position-Topic-dfsp1</text><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1098" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1094" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1101" y="101.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1098" y="2198.3359"/><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1094" y="2202.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1101" y="2222.8711">Event-Topic</text><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1213" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1209" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1216" y="101.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1213" y="2198.3359"/><rect fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1209" y="2202.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1216" y="2222.8711">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1366" y="113.334">Transfer DAO</text><ellipse cx="1415.5" cy="83.7988" fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1403.5" x2="1427.5" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="1366" y="2211.8711">Transfer DAO</text><ellipse cx="1415.5" cy="2230.8242" fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1403.5" x2="1427.5" y1="2244.8242" y2="2244.8242"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1475" y="113.334">Participant DAO</text><ellipse cx="1532" cy="83.7988" fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1520" x2="1544" y1="97.7988" y2="97.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="1475" y="2211.8711">Participant DAO</text><ellipse cx="1532" cy="2230.8242" fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1520" x2="1544" y1="2244.8242" y2="2244.8242"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1766" y="113.334">Central Store</text><path d="M1796,63.7988 C1796,53.7988 1814,53.7988 1814,53.7988 C1814,53.7988 1832,53.7988 1832,63.7988 L1832,89.7988 C1832,99.7988 1814,99.7988 1814,99.7988 C1814,99.7988 1796,99.7988 1796,89.7988 L1796,63.7988 " fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1796,63.7988 C1796,73.7988 1814,73.7988 1814,73.7988 C1814,73.7988 1832,73.7988 1832,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="1766" y="2211.8711">Central Store</text><path d="M1796,2224.8242 C1796,2214.8242 1814,2214.8242 1814,2214.8242 C1814,2214.8242 1832,2214.8242 1832,2224.8242 L1832,2250.8242 C1832,2260.8242 1814,2260.8242 1814,2260.8242 C1814,2260.8242 1796,2260.8242 1796,2250.8242 L1796,2224.8242 " fill="#FEFECE" filter="url(#f1uuq07un4ikqq)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1796,2224.8242 C1796,2234.8242 1814,2234.8242 1814,2234.8242 C1814,2234.8242 1832,2234.8242 1832,2224.8242 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="102" y="171.9082"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="2063.0488" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="472" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="994" y="2137.3359"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1410.5" y="960.0508"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="121.9316" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1410.5" y="1587.6406"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1527" y="427.082"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1527" y="693.5664"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1809" y="456.3926"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1809" y="722.877"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="62.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1809" y="989.3613"/><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1809" y="1616.9512"/><path d="M13,133.2871 L236,133.2871 L236,140.2871 L226,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="2049.0488" style="stroke: #000000; stroke-width: 2.0;" width="1906" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="178" x="28" y="146.8555">Prepare Handler Consume</text><polygon fill="#A80036" points="123,167.9082,113,171.9082,123,175.9082,119,171.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117" x2="471" y1="171.9082" y2="171.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="129" y="167.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="142" y="167.166">Consume Prepare event batch of messages for Payer</text><path d="M388,216.9082 L603,216.9082 L603,223.9082 L593,233.9082 L388,233.9082 L388,216.9082 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="157.5527" style="stroke: #000000; stroke-width: 2.0;" width="821" x="388" y="216.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="403" y="230.4766">Persist Event Information</text><polygon fill="#A80036" points="1134.5,276.5293,1144.5,280.5293,1134.5,284.5293,1138.5,280.5293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="1140.5" y1="280.5293" y2="280.5293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="489" y="275.7871">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="502" y="275.7871">Publish event information</text><rect fill="#FFFFFF" filter="url(#f1uuq07un4ikqq)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="803" x="395" y="288.5293"/><polygon fill="#EEEEEE" points="395,288.5293,459,288.5293,459,295.5293,449,305.5293,395,305.5293,395,288.5293" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="408" y="303.0977">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="697.5" y="322.0977">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="36" x="855.5" y="322.0977">9.1.0.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="855.5" x2="891.5" y1="324.0977" y2="324.0977"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="891.5" y="322.0977">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="701.5" y="337.4082"/><path d="M388,388.4609 L636,388.4609 L636,395.4609 L626,405.4609 L388,405.4609 L388,388.4609 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="252.4844" style="stroke: #000000; stroke-width: 2.0;" width="1484" x="388" y="388.4609"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="403" y="402.0293">Fetch batch Payer information</text><polygon fill="#A80036" points="1515,423.082,1525,427.082,1515,431.082,1519,427.082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="1521" y1="427.082" y2="427.082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="489" y="422.3398">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="404" x="502" y="422.3398">Request to retrieve batch of Payer Participant details (if it exists)</text><polygon fill="#A80036" points="1797,452.3926,1807,456.3926,1797,460.3926,1801,456.3926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1537" x2="1803" y1="456.3926" y2="456.3926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1544" y="451.6504">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1557" y="451.6504">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#f1uuq07un4ikqq)" points="1778,469.3926,1850,469.3926,1860,480.3926,1850,492.3926,1778,492.3926,1768,480.3926,1778,469.3926" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1780" y="485.9609">participant</text><polygon fill="#A80036" points="1548,515.0137,1538,519.0137,1548,523.0137,1544,519.0137" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1542" x2="1813" y1="519.0137" y2="519.0137"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1554" y="514.2715">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1567" y="514.2715">Return Participant details if it exists</text><polygon fill="#A80036" points="493,544.3242,483,548.3242,493,552.3242,489,548.3242" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="487" x2="1531" y1="548.3242" y2="548.3242"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="499" y="543.582">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="512" y="543.582">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="524" y1="577.6348" y2="577.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="524" y1="577.6348" y2="590.6348"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="483" x2="524" y1="590.6348" y2="590.6348"/><polygon fill="#A80036" points="493,586.6348,483,590.6348,493,594.6348,489,590.6348" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="489" y="572.8926">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="502" y="572.8926">Validate Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="524" y1="619.9453" y2="619.9453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="524" y1="619.9453" y2="632.9453"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="483" x2="524" y1="632.9453" y2="632.9453"/><polygon fill="#A80036" points="493,628.9453,483,632.9453,493,636.9453,489,632.9453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="489" y="615.2031">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="378" x="502" y="615.2031">store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYER</text><path d="M388,654.9453 L638,654.9453 L638,661.9453 L628,671.9453 L388,671.9453 L388,654.9453 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="252.4844" style="stroke: #000000; stroke-width: 2.0;" width="1484" x="388" y="654.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="205" x="403" y="668.5137">Fetch batch Payee information</text><polygon fill="#A80036" points="1515,689.5664,1525,693.5664,1515,697.5664,1519,693.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="1521" y1="693.5664" y2="693.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="489" y="688.8242">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="406" x="502" y="688.8242">Request to retrieve batch of Payee Participant details (if it exists)</text><polygon fill="#A80036" points="1797,718.877,1807,722.877,1797,726.877,1801,722.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1537" x2="1803" y1="722.877" y2="722.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1544" y="718.1348">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="1566" y="718.1348">Request Participant details</text><polygon fill="#FFFFE0" filter="url(#f1uuq07un4ikqq)" points="1778,735.877,1850,735.877,1860,746.877,1850,758.877,1778,758.877,1768,746.877,1778,735.877" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1780" y="752.4453">participant</text><polygon fill="#A80036" points="1548,781.498,1538,785.498,1548,789.498,1544,785.498" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1542" x2="1813" y1="785.498" y2="785.498"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1554" y="780.7559">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="1576" y="780.7559">Return Participant details if it exists</text><polygon fill="#A80036" points="493,810.8086,483,814.8086,493,818.8086,489,814.8086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="487" x2="1531" y1="814.8086" y2="814.8086"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="499" y="810.0664">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="226" x="521" y="810.0664">Return Participant details if it exists</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="524" y1="844.1191" y2="844.1191"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="524" y1="844.1191" y2="857.1191"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="483" x2="524" y1="857.1191" y2="857.1191"/><polygon fill="#A80036" points="493,853.1191,483,857.1191,493,861.1191,489,857.1191" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="839.377">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="511" y="839.377">Validate Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="524" y1="886.4297" y2="886.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="524" y1="886.4297" y2="899.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="483" x2="524" y1="899.4297" y2="899.4297"/><polygon fill="#A80036" points="493,895.4297,483,899.4297,493,903.4297,489,899.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="881.6875">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="377" x="511" y="881.6875">store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYEE</text><path d="M388,921.4297 L593,921.4297 L593,928.4297 L583,938.4297 L388,938.4297 L388,921.4297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="210.1738" style="stroke: #000000; stroke-width: 2.0;" width="1484" x="388" y="921.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="160" x="403" y="934.998">Fetch batch of transfers</text><polygon fill="#A80036" points="1398.5,956.0508,1408.5,960.0508,1398.5,964.0508,1402.5,960.0508" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="1404.5" y1="960.0508" y2="960.0508"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="955.3086">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="313" x="511" y="955.3086">Request to retrieve batch of Transfers (if it exists)</text><polygon fill="#A80036" points="1797,985.3613,1807,989.3613,1797,993.3613,1801,989.3613" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1420.5" x2="1803" y1="989.3613" y2="989.3613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1427.5" y="984.6191">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="1449.5" y="984.6191">Request batch of Transfers</text><polygon fill="#FFFFE0" filter="url(#f1uuq07un4ikqq)" points="1787,1002.3613,1840,1002.3613,1850,1013.3613,1840,1025.3613,1787,1025.3613,1777,1013.3613,1787,1002.3613" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="1789" y="1018.9297">transfer</text><polygon fill="#A80036" points="1431.5,1047.9824,1421.5,1051.9824,1431.5,1055.9824,1427.5,1051.9824" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1425.5" x2="1813" y1="1051.9824" y2="1051.9824"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1437.5" y="1047.2402">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="1459.5" y="1047.2402">Return batch of Transfers (if it exists)</text><polygon fill="#A80036" points="493,1077.293,483,1081.293,493,1085.293,489,1081.293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="487" x2="1414.5" y1="1081.293" y2="1081.293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="499" y="1076.5508">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="521" y="1076.5508">Return batch of Transfer (if it exists)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="524" y1="1110.6035" y2="1110.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="524" y1="1110.6035" y2="1123.6035"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="483" x2="524" y1="1123.6035" y2="1123.6035"/><polygon fill="#A80036" points="493,1119.6035,483,1123.6035,493,1127.6035,489,1123.6035" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="1105.8613">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="254" x="511" y="1105.8613">store result set in var: $LIST_TRANSFERS</text><path d="M368,1145.6035 L442,1145.6035 L442,1152.6035 L432,1162.6035 L368,1162.6035 L368,1145.6035 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1029.7324" style="stroke: #000000; stroke-width: 2.0;" width="1541" x="368" y="1145.6035"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="383" y="1159.1719">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="457" y="1158.2383">[for each message in batch]</text><path d="M378,1169.9141 L597,1169.9141 L597,1176.9141 L587,1186.9141 L378,1186.9141 L378,1169.9141 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="365.1055" style="stroke: #000000; stroke-width: 2.0;" width="631" x="378" y="1169.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="174" x="393" y="1183.4824">Validate Prepare Transfer</text><path d="M388,1194.2246 L530,1194.2246 L530,1201.2246 L520,1211.2246 L388,1211.2246 L388,1194.2246 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="610" x="388" y="1194.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="403" y="1207.793">Validate Payer</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="524" y1="1232.8457" y2="1232.8457"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="524" y1="1232.8457" y2="1245.8457"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="483" x2="524" y1="1245.8457" y2="1245.8457"/><polygon fill="#A80036" points="493,1241.8457,483,1245.8457,493,1249.8457,489,1245.8457" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="1228.1035">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="475" x="511" y="1228.1035">Validate Payer against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYER</text><path d="M388,1267.8457 L532,1267.8457 L532,1274.8457 L522,1284.8457 L388,1284.8457 L388,1267.8457 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="611" x="388" y="1267.8457"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="99" x="403" y="1281.4141">Validate Payee</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="524" y1="1306.4668" y2="1306.4668"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="524" y1="1306.4668" y2="1319.4668"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="483" x2="524" y1="1319.4668" y2="1319.4668"/><polygon fill="#A80036" points="493,1315.4668,483,1319.4668,493,1323.4668,489,1319.4668" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="1301.7246">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="476" x="511" y="1301.7246">Validate Payee against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYEE</text><path d="M388,1341.4668 L540,1341.4668 L540,1348.4668 L530,1358.4668 L388,1358.4668 L388,1341.4668 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="59.6211" style="stroke: #000000; stroke-width: 2.0;" width="554" x="388" y="1341.4668"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="107" x="403" y="1355.0352">Duplicate check</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="524" y1="1380.0879" y2="1380.0879"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="524" y1="1380.0879" y2="1393.0879"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="483" x2="524" y1="1393.0879" y2="1393.0879"/><polygon fill="#A80036" points="493,1389.0879,483,1393.0879,493,1397.0879,489,1393.0879" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="1375.3457">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="419" x="511" y="1375.3457">Validate duplicate Check against in-memory var $LIST_TRANSFERS</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="524" y1="1429.3984" y2="1429.3984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="524" y1="1429.3984" y2="1442.3984"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="483" x2="524" y1="1442.3984" y2="1442.3984"/><polygon fill="#A80036" points="493,1438.3984,483,1442.3984,493,1446.3984,489,1442.3984" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="1424.6563">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="511" y="1424.6563">Validate amount</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="524" y1="1471.709" y2="1471.709"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="524" y1="1471.709" y2="1484.709"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="483" x2="524" y1="1484.709" y2="1484.709"/><polygon fill="#A80036" points="493,1480.709,483,1484.709,493,1488.709,489,1484.709" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="1466.9668">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="511" y="1466.9668">Validate crypto-condition</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="524" y1="1514.0195" y2="1514.0195"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="524" x2="524" y1="1514.0195" y2="1527.0195"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="483" x2="524" y1="1527.0195" y2="1527.0195"/><polygon fill="#A80036" points="493,1523.0195,483,1527.0195,493,1531.0195,489,1527.0195" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="1509.2773">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="422" x="511" y="1509.2773">Validate message signature (to be confirmed in future requirement)</text><path d="M388,1549.0195 L919,1549.0195 L919,1556.0195 L909,1566.0195 L388,1566.0195 L388,1549.0195 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="168.5527" style="stroke: #000000; stroke-width: 2.0;" width="1511" x="388" y="1549.0195"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="486" x="403" y="1562.5879">Persist Transfer State (with transferState='RECEIVED' on validation pass)</text><polygon fill="#A80036" points="1398.5,1583.6406,1408.5,1587.6406,1398.5,1591.6406,1402.5,1587.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="1404.5" y1="1587.6406" y2="1587.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="1582.8984">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="511" y="1582.8984">Request to persist transfer</text><polygon fill="#A80036" points="1797,1612.9512,1807,1616.9512,1797,1620.9512,1801,1616.9512" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1420.5" x2="1803" y1="1616.9512" y2="1616.9512"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1427.5" y="1612.209">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1449.5" y="1612.209">Persist transfer</text><polygon fill="#FFFFE0" filter="url(#f1uuq07un4ikqq)" points="1748,1659.9512,1879,1659.9512,1889,1670.9512,1879,1682.9512,1748,1682.9512,1738,1670.9512,1748,1659.9512" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1750" y="1676.5195">transferStateChange</text><polygon fill="#A80036" points="493,1705.5723,483,1709.5723,493,1713.5723,489,1709.5723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="487" x2="1414.5" y1="1709.5723" y2="1709.5723"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="499" y="1704.8301">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="521" y="1704.8301">Return success</text><path d="M487,1729.5723 L487,2106.5723 L749,2106.5723 L749,1739.5723 L739,1729.5723 L487,1729.5723 " fill="#FFFF00" filter="url(#f1uuq07un4ikqq)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M739,1729.5723 L739,1739.5723 L749,1739.5723 L739,1729.5723 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="493" y="1747.1406">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="493" y="1762.4512">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="509" y="1777.7617">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="509" y="1793.0723">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="509" y="1808.3828">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="509" y="1823.6934">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="509" y="1839.0039">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="525" y="1854.3145">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="525" y="1869.625">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="509" y="1884.9355">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="509" y="1900.2461">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="525" y="1915.5566">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="541" y="1930.8672">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="541" y="1946.1777">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="541" y="1961.4883">type: position,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="541" y="1976.7988">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="541" y="1992.1094">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="541" y="2007.4199">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="557" y="2022.7305">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="557" y="2038.041">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="541" y="2053.3516">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="525" y="2068.6621">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="509" y="2083.9727">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="493" y="2099.2832">}</text><polygon fill="#A80036" points="982,2133.3359,992,2137.3359,982,2141.3359,986,2137.3359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="482" x2="988" y1="2137.3359" y2="2137.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="489" y="2132.5938">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="251" x="511" y="2132.5938">Route &amp; Publish Position event for Payer</text><!--
@startuml
title 1.1.1.b. Prepare Handler Consume (batch messages)

autonumber


collections "Prepare-Topic-dfsp1" as TOPIC_PREPARE_DFSP1
control "Prepare Event Handler" as PREP_HANDLER
collections "Position-Topic-dfsp1" as TOPIC_POSITION_DFSP1
collections "Event-Topic" as TOPIC_EVENTS
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
entity "Transfer DAO" as TRANS_DAO
entity "Participant DAO" as PARTICIPANT_DAO
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_PREPARE_DFSP1
    participant PREP_HANDLER
    participant TOPIC_POSITION_DFSP1
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATIONS
    participant TRANS_DAO
    participant PARTICIPANT_DAO
    participant DB
end box

activate PREP_HANDLER
group Prepare Handler Consume
    TOPIC_PREPARE_DFSP1 <- PREP_HANDLER: Consume Prepare event batch of messages for Payer
    activate TOPIC_PREPARE_DFSP1
    deactivate TOPIC_PREPARE_DFSP1
    group Persist Event Information
        |||
        PREP_HANDLER -> TOPIC_EVENTS: Publish event information
        ref over PREP_HANDLER, TOPIC_EVENTS :  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/develop/CentralServices/seq_diagrams/seq-event-9.1.0.svg 9.1.0.]]} \n
        |||
    end

    group Fetch batch Payer information
        PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve batch of Payer Participant details (if it exists)
        activate PARTICIPANT_DAO
        PARTICIPANT_DAO -> DB: Request Participant details
        hnote over DB #lightyellow
            participant
        end note
        activate DB
        PARTICIPANT_DAO <- - DB: Return Participant details if it exists
        deactivate DB
        PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
        deactivate PARTICIPANT_DAO
        PREP_HANDLER <-> PREP_HANDLER: Validate Payer
        PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYER
    end

    group Fetch batch Payee information
        PREP_HANDLER -> PARTICIPANT_DAO: Request to retrieve batch of Payee Participant details (if it exists)
        activate PARTICIPANT_DAO
        PARTICIPANT_DAO -> DB: Request Participant details
        hnote over DB #lightyellow
            participant
        end note
        activate DB
        PARTICIPANT_DAO <- - DB: Return Participant details if it exists
        deactivate DB
        PARTICIPANT_DAO - -> PREP_HANDLER: Return Participant details if it exists
        deactivate PARTICIPANT_DAO
        PREP_HANDLER <-> PREP_HANDLER: Validate Payee
        PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_PARTICIPANTS_DETAILS_PAYEE
    end

    group Fetch batch of transfers
        PREP_HANDLER -> TRANS_DAO: Request to retrieve batch of Transfers (if it exists)
        activate TRANS_DAO
        TRANS_DAO -> DB: Request batch of Transfers
        hnote over DB #lightyellow
            transfer
        end note
        activate DB
        TRANS_DAO <- - DB: Return batch of Transfers (if it exists)
        deactivate DB
        TRANS_DAO - -> PREP_HANDLER: Return batch of Transfer (if it exists)
        deactivate TRANS_DAO
        PREP_HANDLER -> PREP_HANDLER: store result set in var: $LIST_TRANSFERS
    end

    loop for each message in batch

        group Validate Prepare Transfer
            group Validate Payer
                PREP_HANDLER <-> PREP_HANDLER: Validate Payer against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYER
            end
            group Validate Payee
                PREP_HANDLER <-> PREP_HANDLER: Validate Payee against in-memory var $LIST_PARTICIPANTS_DETAILS_PAYEE
            end
            group Duplicate check
                PREP_HANDLER <-> PREP_HANDLER: Validate duplicate Check against in-memory var $LIST_TRANSFERS
            end
            PREP_HANDLER <-> PREP_HANDLER: Validate amount
            PREP_HANDLER <-> PREP_HANDLER: Validate crypto-condition
            PREP_HANDLER <-> PREP_HANDLER: Validate message signature (to be confirmed in future requirement)
        end

        group Persist Transfer State (with transferState='RECEIVED' on validation pass)
            PREP_HANDLER -> TRANS_DAO: Request to persist transfer
            activate TRANS_DAO
            TRANS_DAO -> DB: Persist transfer
            hnote over DB #lightyellow
                transferStateChange
            end note
            activate DB
            deactivate DB
            TRANS_DAO - -> PREP_HANDLER: Return success
            deactivate TRANS_DAO
        end

        note right of PREP_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payeeFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: position,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        PREP_HANDLER -> TOPIC_POSITION_DFSP1: Route & Publish Position event for Payer
        activate TOPIC_POSITION_DFSP1
        deactivate TOPIC_POSITION_DFSP1
    end
end
deactivate PREP_HANDLER
@enduml

PlantUML version 1.2018.05(Sat May 05 23:00:17 EEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_131-b11
Operating System: Mac OS X
OS Version: 10.13.6
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>