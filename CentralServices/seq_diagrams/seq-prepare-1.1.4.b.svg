<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="907px" preserveAspectRatio="none" style="width:2292px;height:907px;" version="1.1" viewBox="0 0 2292 907" width="2292px" zoomAndPan="magnify"><defs><filter height="300%" id="fonpg3kv2ixwm" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="512" x="891" y="23.5352">1.1.4.b. Send notification to Participant (Payer/Payee) (batch messages)</text><rect fill="#D3D3D3" height="862.1641" style="stroke: #A80036; stroke-width: 1.0;" width="179" x="4" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="7" y="47.0566">Financial Service Provider</text><rect fill="#ADD8E6" height="862.1641" style="stroke: #A80036; stroke-width: 1.0;" width="241" x="703" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="157" x="745" y="47.0566">ML API Adapter Service</text><rect fill="#FFFFE0" height="862.1641" style="stroke: #A80036; stroke-width: 1.0;" width="1040" x="1211" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="1680.5" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="619.9004" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="818.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1283.5" y="209.0859"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="198.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1434" y="317.0176"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="179.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1434" y="552.1914"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="140.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1638" y="346.3281"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1871" y="581.502"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="173.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2194" y="610.8125"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="605.9004" style="stroke: #000000; stroke-width: 2.0;" width="2247" x="34" y="170.7754"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="515.2793" style="stroke: #000000; stroke-width: 2.0;" width="2227" x="44" y="254.3965"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="245.4844" style="stroke: #000000; stroke-width: 2.0;" width="1008.5" x="697" y="278.707"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="93" x2="93" y1="153.7754" y2="793.6758"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="823" x2="823" y1="153.7754" y2="793.6758"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1288" x2="1288" y1="153.7754" y2="793.6758"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1439" x2="1439" y1="153.7754" y2="793.6758"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1642.5" x2="1642.5" y1="153.7754" y2="793.6758"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1756" x2="1756" y1="153.7754" y2="793.6758"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1876" x2="1876" y1="153.7754" y2="793.6758"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2199" x2="2199" y1="153.7754" y2="793.6758"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="64" y="134.334">DFSP(n)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="54" y="150.8223">Participant</text><ellipse cx="93.5" cy="63.7988" fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M93.5,71.7988 L93.5,98.7988 M80.5,79.7988 L106.5,79.7988 M93.5,98.7988 L80.5,113.7988 M93.5,98.7988 L106.5,113.7988 " fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="64" y="806.2109">DFSP(n)</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="54" y="822.6992">Participant</text><ellipse cx="93.5" cy="835.6523" fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M93.5,843.6523 L93.5,870.6523 M80.5,851.6523 L106.5,851.6523 M93.5,870.6523 L80.5,885.6523 M93.5,870.6523 L106.5,885.6523 " fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="707" y="150.8223">ML API Notification Event Handler</text><ellipse cx="823.5" cy="121.2871" fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="819.5,109.2871,825.5,104.2871,823.5,109.2871,825.5,114.2871,819.5,109.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="227" x="707" y="806.2109">ML API Notification Event Handler</text><ellipse cx="823.5" cy="825.1641" fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="819.5,813.1641,825.5,808.1641,823.5,813.1641,825.5,818.1641,819.5,813.1641" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1219" y="114.2871"/><rect fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1215" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1222" y="138.8223">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1219" y="792.6758"/><rect fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="1215" y="796.6758"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="1222" y="817.2109">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1372" y="150.8223">Central Service API</text><path d="M1418.5,109.2871 L1418.5,133.2871 M1418.5,121.2871 L1435.5,121.2871 " fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1447.5" cy="121.2871" fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1372" y="806.2109">Central Service API</text><path d="M1418.5,813.1641 L1418.5,837.1641 M1418.5,825.1641 L1435.5,825.1641 " fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="1447.5" cy="825.1641" fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1594.5" y="114.2871"/><rect fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1590.5" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1597.5" y="138.8223">Event-Topic</text><rect fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1594.5" y="792.6758"/><rect fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1590.5" y="796.6758"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="1597.5" y="817.2109">Event-Topic</text><rect fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1706" y="118.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1713" y="138.8223">EVENT_DAO</text><rect fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="96" x="1706" y="792.6758"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="1713" y="813.2109">EVENT_DAO</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1816" y="150.8223">Notification DAO</text><ellipse cx="1876" cy="121.2871" fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1864" x2="1888" y1="135.2871" y2="135.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="114" x="1816" y="806.2109">Notification DAO</text><ellipse cx="1876" cy="825.1641" fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1864" x2="1888" y1="839.1641" y2="839.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2151" y="150.8223">Central Store</text><path d="M2181,101.2871 C2181,91.2871 2199,91.2871 2199,91.2871 C2199,91.2871 2217,91.2871 2217,101.2871 L2217,127.2871 C2217,137.2871 2199,137.2871 2199,137.2871 C2199,137.2871 2181,137.2871 2181,127.2871 L2181,101.2871 " fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2181,101.2871 C2181,111.2871 2199,111.2871 2199,111.2871 C2199,111.2871 2217,111.2871 2217,101.2871 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2151" y="806.2109">Central Store</text><path d="M2181,819.1641 C2181,809.1641 2199,809.1641 2199,809.1641 C2199,809.1641 2217,809.1641 2217,819.1641 L2217,845.1641 C2217,855.1641 2199,855.1641 2199,855.1641 C2199,855.1641 2181,855.1641 2181,845.1641 L2181,819.1641 " fill="#FEFECE" filter="url(#fonpg3kv2ixwm)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2181,819.1641 C2181,829.1641 2199,829.1641 2199,829.1641 C2199,829.1641 2217,829.1641 2217,819.1641 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="619.9004" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="818.5" y="163.7754"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1283.5" y="209.0859"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="198.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1434" y="317.0176"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="179.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1434" y="552.1914"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="140.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1638" y="346.3281"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="121.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1871" y="581.502"/><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="173.8633" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2194" y="610.8125"/><rect fill="none" height="605.9004" style="stroke: #000000; stroke-width: 2.0;" width="2247" x="34" y="170.7754"/><polygon fill="#EEEEEE" points="34,170.7754,286,170.7754,286,177.7754,276,187.7754,34,187.7754,34,170.7754" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="49" y="184.3438">Send notification to Participant</text><polygon fill="#A80036" points="1271.5,205.0859,1281.5,209.0859,1271.5,213.0859,1275.5,209.0859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="828.5" x2="1277.5" y1="209.0859" y2="209.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="835.5" y="204.6543">1</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="423" x="848.5" y="204.6543">Consume Notifications event batch of messages for Participant</text><rect fill="none" height="515.2793" style="stroke: #000000; stroke-width: 2.0;" width="2227" x="44" y="254.3965"/><polygon fill="#EEEEEE" points="44,254.3965,118,254.3965,118,261.3965,108,271.3965,44,271.3965,44,254.3965" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="59" y="267.9648">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="133" y="267.0313">[for each message in batch]</text><rect fill="none" height="245.4844" style="stroke: #000000; stroke-width: 2.0;" width="1008.5" x="697" y="278.707"/><polygon fill="#EEEEEE" points="697,278.707,912,278.707,912,285.707,902,295.707,697,295.707,697,278.707" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="170" x="712" y="292.2754">Persist Event Information</text><polygon fill="#A80036" points="1422,313.0176,1432,317.0176,1422,321.0176,1426,317.0176" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="828.5" x2="1428" y1="317.0176" y2="317.0176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="835.5" y="312.5859">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="393" x="848.5" y="312.5859">Request to persist event information - POST - HTTP://events/</text><polygon fill="#A80036" points="1626,342.3281,1636,346.3281,1626,350.3281,1630,346.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1444" x2="1632" y1="346.3281" y2="346.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1451" y="341.8965">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1464" y="341.8965">Publish event information</text><rect fill="#FFFFFF" filter="url(#fonpg3kv2ixwm)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="210" x="1587.5" y="379.6387"/><polygon fill="#EEEEEE" points="1587.5,379.6387,1651.5,379.6387,1651.5,386.6387,1641.5,396.6387,1587.5,396.6387,1587.5,379.6387" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="1600.5" y="394.207">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="1593.5" y="413.207">Event Handler Consume {9.1.0.}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1597.5" y="428.5176"/><polygon fill="#A80036" points="1455,482.5703,1445,486.5703,1455,490.5703,1451,486.5703" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1449" x2="1642" y1="486.5703" y2="486.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1461" y="482.1387">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1474" y="482.1387">Return success</text><polygon fill="#A80036" points="839.5,511.8809,829.5,515.8809,839.5,519.8809,835.5,515.8809" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="833.5" x2="1438" y1="515.8809" y2="515.8809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="845.5" y="511.4492">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="858.5" y="511.4492">Return success</text><polygon fill="#A80036" points="1422,548.1914,1432,552.1914,1422,556.1914,1426,552.1914" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="828.5" x2="1428" y1="552.1914" y2="552.1914"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="835.5" y="547.7598">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="516" x="848.5" y="547.7598">Request Notifications details for Participant - GET - HTTP://notifications/DFPS(n)</text><polygon fill="#A80036" points="1859,577.502,1869,581.502,1859,585.502,1863,581.502" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1444" x2="1865" y1="581.502" y2="581.502"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1451" y="577.0703">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1464" y="577.0703">Fetch Notifications details for Participant</text><polygon fill="#A80036" points="2182,606.8125,2192,610.8125,2182,614.8125,2186,610.8125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1881" x2="2188" y1="610.8125" y2="610.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1888" y="606.3809">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1901" y="606.3809">Fetch Notifications details for Participant</text><polygon fill="#FFFFE0" filter="url(#fonpg3kv2ixwm)" points="2147,624.123,2251,624.123,2261,635.123,2251,647.123,2147,647.123,2137,635.123,2147,624.123" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="2149" y="640.6914">transferPosition</text><polygon fill="#A80036" points="1892,669.4336,1882,673.4336,1892,677.4336,1888,673.4336" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1886" x2="2193" y1="673.4336" y2="673.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1898" y="669.002">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="276" x="1911" y="669.002">Retrieved Notification details for Participant</text><polygon fill="#A80036" points="1455,698.7441,1445,702.7441,1455,706.7441,1451,702.7441" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1449" x2="1875" y1="702.7441" y2="702.7441"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1461" y="698.3125">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="1483" y="698.3125">Return Notifications details for Participant</text><polygon fill="#A80036" points="839.5,728.0547,829.5,732.0547,839.5,736.0547,835.5,732.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="833.5" x2="1438" y1="732.0547" y2="732.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="845.5" y="727.623">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="867.5" y="727.623">Return Notifications details for Participant</text><polygon fill="#A80036" points="104.5,757.3652,94.5,761.3652,104.5,765.3652,100.5,761.3652" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="98.5" x2="817.5" y1="761.3652" y2="761.3652"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="110.5" y="756.9336">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="633" x="132.5" y="756.9336">Callback with Prepare result to Participant to specified URL - PUT - HTTP://&lt;dfsp-host&gt;&gt;/transfers</text><!--
@startuml
' declate title
title 1.1.4.b. Send notification to Participant (Payer/Payee) (batch messages)

autonumber

' Actor Keys:
'   boundary - APIs/Interfaces, etc
'   collections - Kafka Topics
'   control - Kafka Consumers
'   entity - Database Access Objects
'   database - Database Persistance Store

' declare actors
actor "DFSP(n)\nParticipant" as DFSP
control "ML API Notification Event Handler" as NOTIFY_HANDLER
boundary "Central Service API" as CSAPI
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
collections "Event-Topic" as TOPIC_EVENTS
entity "Notification DAO" as NOTIFY_DAO
database "Central Store" as DB

box "Financial Service Provider" #lightGray
	participant DFSP
end box

box "ML API Adapter Service" #LightBlue
	participant NOTIFY_HANDLER
end box

box "Central Service" #LightYellow
participant TOPIC_NOTIFICATIONS
    participant CSAPI
    participant TOPIC_EVENTS
    participant EVENT_DAO
    participant NOTIFY_DAO
    participant DB
end box

' start flow
activate NOTIFY_HANDLER
group Send notification to Participant
    TOPIC_NOTIFICATIONS <- NOTIFY_HANDLER: <color #FF0000>**Consume Notifications event batch of messages for Participant**</color>
    activate TOPIC_NOTIFICATIONS
    deactivate TOPIC_NOTIFICATIONS
    loop for each message in batch
        group Persist Event Information
            NOTIFY_HANDLER -> CSAPI: Request to persist event information - POST - HTTP://events/
            activate CSAPI
            CSAPI -> TOPIC_EVENTS: Publish event information
            activate TOPIC_EVENTS
            |||
            ref over TOPIC_EVENTS :  Event Handler Consume {9.1.0.} \n
            |||
            TOPIC_EVENTS - -> CSAPI: Return success
            deactivate TOPIC_EVENTS
            CSAPI - -> NOTIFY_HANDLER: Return success
            deactivate CSAPI
        end
        NOTIFY_HANDLER -> CSAPI: Request Notifications details for Participant - GET - HTTP://notifications/DFPS(n)
        activate CSAPI
        CSAPI -> NOTIFY_DAO: Fetch Notifications details for Participant
        activate NOTIFY_DAO
        NOTIFY_DAO -> DB: Fetch Notifications details for Participant
        activate DB
        hnote over DB #lightyellow
            transferPosition
        end note
        DB - -> NOTIFY_DAO: Retrieved Notification details for Participant
        'deactivate DB
        NOTIFY_DAO - -> CSAPI: Return Notifications details for Participant
        deactivate NOTIFY_DAO
        CSAPI - -> NOTIFY_HANDLER: Return Notifications details for Participant
        deactivate CSAPI
        NOTIFY_HANDLER - -> DFSP: Callback with Prepare result to Participant to specified URL - PUT - HTTP://<dfsp-host>>/transfers
    end
end
deactivate NOTIFY_HANDLER
@enduml

PlantUML version 1.2017.18(Fri Oct 06 17:56:32 BST 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_152-b16
Operating System: Mac OS X
OS Version: 10.13.4
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>